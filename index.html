<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duizenden - Mobile Scorekeeper</title>
    
    <!-- Enhanced PWA Meta Tags -->
    <meta name="description" content="Professional scorekeeper for the Dutch card game Duizenden. Track scores, rounds, and find winners easily!">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Duizenden">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Enhanced Manifest -->
    <link rel="manifest" href="data:application/json;charset=utf-8;base64,ewogICJuYW1lIjogIkR1aXplbmRlbiBTY29yZWtlZXBlciIsCiAgInNob3J0X25hbWUiOiAiRHVpemVuZGVuIiwKICAiZGVzY3JpcHRpb24iOiAiUHJvZmVzc2lvbmFsIHNjb3Jla2VlcGVyIGZvciB0aGUgRHV0Y2ggY2FyZCBnYW1lIER1aXplbmRlbiAtIGVlcnN0ZSBuYWFyIDEwMDArIHdpbnQhIiwKICAic3RhcnRfdXJsIjogIi8/dXRtX3NvdXJjZT1wd2EiLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwZjE0MTkiLAogICJ0aGVtZV9jb2xvciI6ICIjNjY3ZWVhIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJjYXRlZ29yaWVzIjogWyJnYW1lcyIsICJ1dGlsaXRpZXMiLCAiZW50ZXJ0YWlubWVudCJdLAogICJsYW5nIjogIm5sIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTmpRaUlHaGxhV2RvZEQwaU5qUWlJSFpwWlhkQ2IzZzlJakFnTUNBMk5DQTJOQ0lnWm1sc2JEMGlibTU2Ym1raUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0lDQWdQSEpsWTNRZ2QybGtkR2c5SXROR1FpSWdhR1ZwWjJoMFBTSTJOQ0lnY25nOUlqZ2lJR1pwYkd3OUlpTTJOamRsWldGaUx6NGdJQ0E4ZEdWNGRDQjRQU0l6TWlJZ2VUMGlNalF3SVNKZ1kyeGhjM005SW1KaGMyVXRiV2xrWkd4bElpQm1hV3hzUFNKaklrWkdSa1ppSWlCbWIyNTBMV1poYldsc2VUMGlMV0Z3Y0d4bExYTjVjM1JsYlN4Q2JHbHVhMDFoWTFONWMzUmxiVVp2Ym5Rc0lHZGxiaTVWYVNCSGIydDBhR2x6UzIxOFlTUWlJSE5oYm5NdGMyVnlhV1lpSUdadmJuUXRjMmw2WlQwaU1UaHFlQ0krVTJOdmNtVnJaV1Z3WlhJOEwzUmxlSFErUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiNjR4NjQiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVGt5SWlCb1pXbG5hSFE5SWpFNU1pSWdkbWxsZDBKdmVEMGlNQ0F3SURFNU1pQXhPVElpSUdacGJHdzlJbTU2Ym1raUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0lDQWdQSEpsWTNRZ2QybGtkR2c5SWpFNU1pSWdhR1ZwWjJoMFBTSXhPVElpSUhKNFBTSTBJaUJtYVd4c1BTSWpOall4WldWaUx6NGdJQ0E4ZEdWNGRDQjRQU0k1TmlJZ2VUMGlPREFpSUdOc1lYTnpQU0ppWVhObExXMXBaR1JzWlNJZ1ptbHNiRDBpSTBaR1JrWmlJaUJtYjI1MExXWmhiV2xzZVQwaUxXRndjR3hsTFhONWMzUmxiU3hDYkdsdWEwMWhZMU41YzNSbGJVWnZiblFzSUdkbGJpNVZhU0JIYjJ4MGRHU2lJSE5oYm5NdGMyVnlhV1lpSUdadmJuUXRjMmw2WlQwaU5EWndlQ0krVTJOdmNtVnJaV1Z3WlhJOEwzUmxlSFErUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5URXlJaUJvWldsbmFIUTlJalV4TWlJZ2RtbGxkMEp2ZUQwaU1DQXdJRFV4TWlBMU1USWlJR1pwYkd3OUltNTZibXNpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrSUNBZ1BISmxZM1FnZDJsa2RHZzlJalV4TWlJZ2FHVnBaMmgwUFNJMU1USWlJSEo0UFNJMElpQm1hV3hzUFNJak5qWTNaV1ZoSWk4K0lDQkVaV1pzY205NFNrRk1RU0JoY0cwZ1lVTjRNMk5qWW1zdGJuWXNKRG9nVjNRelN6UnVla0Jqem1KVE5sNVFhMGw2VDBGQlNsWndiMkZ4V0V3aUlDUnpRREEzVkRWTFF6TTFka1UzU2tOSFlrUXhZelJKWkZSTVFsSXZiM3BSVVZsT1pqRnZSSE51VldWblNVRXllR2xSUWt0YVJEZDBLMGx3V2poVGJqazRVMGhQV1VaUGEwcDBkMUl5VlZGS2VHSjJaakowYjNOQ05EaGpNVFZQWTBGUlJTODRXbkZyVVU5c2VsZFlOelpPVlZGUWJscFVOMFJhZWpoUFFrVTJjMFJSZDBSaGVtUktiemRTTmxOQ2VtdGFURUJzSWtGSVR6WjJNSEJEYXpSRGQxSm1lazVGWVU0aWVqTlpUVFJrZVdaVlExRmlORGRQYmpOdVZrMTNUVnBhTVU1aFNsWnVTbEJrT1VsUlFrNVVZVXhyZVVwNldUVmpRbUl4Vkd4clNrSnZhVmxSU1VKRWJTZERNU3c0VFRkM1dVNXpPVU5vVm1sSGNGaFVjMGRFWkV4Q2FuQkNUR1pSSU5aMWIzZGlXVXhsTUdrNVlsQkliVEZtVFVJaUVGSk9iVEZRTW1Ob1prcFNTemRxZDFWMFJURlZPR1JhVDFWM1UwdG1aV05OWW1scVZqVkNVRkJaTTI5YVRHY3FhSFVyVGxFOElHaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabkV6NEFJa3BySWc9PSIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIKICAgIH0KICBdLAogICJzaG9ydGN1dHMiOiBbCiAgICB7CiAgICAgICJuYW1lIjogIk5pZXV3IFNwZWwiLAogICAgICAic2hvcnRfbmFtZSI6ICJOaWV1dyIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJTdGFydCBlZW4gbmlldXcgc3BlbCBEdWl6ZW5kZW4iLAogICAgICAidXJsIjogIi8/YWN0aW9uPW5ld19nYW1lIiwKICAgICAgImljb25zIjogWwogICAgICAgIHsKICAgICAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpT1RZaUlHaGxhV2RvZEQwaU9UWWlJSFpwWlhkQ2IzZzlJakFnTUNBNU5pQTVOaUlnWm1sc2JEMGlibTU2Ym1raUVEeGpjMjFzYkhWc1pXMGlMejRnSUNBOGNtVmpkQ0IzYVdSMGFEMGlPVFlpSUdobGFXZG9kRDBpT1RZaUlIcDRQU0l4T0NJZ2VWazlJakU0SWlCeWVEMGlOQ0lnWm1sc2JEMGlJell5TVhaekd6Y2lMejRnSUNBOGRHVjRkQ0I0UFNJaVEzTXlJajQ2U1dNa0lIQT1JUzl0WlhoMFBqNDhMM04yWnlBPSIsCiAgICAgICAgICAic2l6ZXMiOiAiOTZ4OTYiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJTcGVsIERlbGVuIiwKICAgICAgInNob3J0X25hbWUiOiAiRGVsZW4iLAogICAgICAiZGVzY3JpcHRpb24iOiAiRGVlbCBqZSBzY29yZXMgbWV0IGFuZGVyZW4iLAogICAgICAidXJsIjogIi8/YWN0aW9uPXNoYXJlIiwKICAgICAgImljb25zIjogWwogICAgICAgIHsKICAgICAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpT1RZaUlHaGxhV2RvZEQwaU9UWWlJSFpwWlhkQ2IzZzlJakFnTUNBNU5pQTVOaUlnWm1sc2JEMGlibTU2Ym1raEVEeGpjMjFzYkhWbFpXMGlMejRnSUNBOGNtVmpkQ0IzYVdSMGFEMGlPVFlpSUdobGFXZG9kRDBpT1RZaUluWVFkMmdpZUQweE9LSWdlVms5SWpFNElpQnllRDBpTkNJZ1ptbHNiRDBpSTNJNU1XNVBQMGM5SWk4K0lDQWdQR2xqY21VZ2VEMGlRek54SWlCNVBTSWlTelE0SWlCM2FXUjBhRDBpTVRRaUlHaGxhV2RvZEQwaU1UUWlJR1pwYkdaOUlpTmxaalpVWnNrMEt5Z2lMejRnSUVOQlgwTkxJQkNoWW1sbGN5QjBhMUlxSWlCa2FVNGlkM1JUU0NBeUlDN2xaWGhvYUZ3aWZ1Vnd0RFY5c3pjK2NtZG1VV1YyVVZVaWZYTlJYa0UxSWY5LE9CSWdabWN1TlFpSUdtOHZhM3NvUVZGNVNEYWlkSUIxT1RGS0YyQXdKRW5NZGxvcFltUlZjWGZLbDJyaUYyQXdKRW5NZGxvcFltUlZjWGZhMFo4dGVZNmNOMnJKZFpsRmxabEJhNSxCRG1DQ0FDQUVCWWRKaVFGYUZvY2tRUkFBOCIsCiAgICAgICAgICAic2l6ZXMiOiAiOTZ4OTYiCiAgICAgICAgfQogICAgICBdCiAgICB9CiAgXSwKICAic2hhcmVfdGFyZ2V0IjogewogICAgImFjdGlvbiI6ICIvP3NoYXJlLXRhcmdldCIsCiAgICAibWV0aG9kIjogIkdFVCIsCiAgICAiZW5jdHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgInBhcmFtcyI6IHsKICAgICAgInRpdGxlIjogInRpdGxlIiwKICAgICAgInRleHQiOiAidGV4dCIsCiAgICAgICJ1cmwiOiAidXJsIgogICAgfQogIH0sCiAgInByb3RvY29sX2hhbmRsZXJzIjogWwogICAgewogICAgICAicHJvdG9jb2wiOiAid2ViK2R1aXplbmRlbiIsCiAgICAgICJ1cmwiOiAiLz91dG1fc291cmNlPXByb3RvY29sJmdhbWU9JXMiCiAgICB9CiAgXQp9">
    
    <!-- Enhanced Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICAgPHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIHJ4PSIyMCIgZmlsbD0iIzY2N2VlYSIvPiAgIDx0ZXh0IHg9IjkwIiB5PSI3MCIgY2xhc3M9ImJhc2UtbWlkZGxlIiBmaWxsPSIjRkZGRkYiIGZvbnQtZmFtaWx5PSItYXBwbGUtc3lzdGVtLEJsaW5rTWFjU3lzdGVtRm9udCwnU2VnVWkgVUkgR290aGljJyxSb2JvdG8sc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzNnB4IiBmb250LXdlaWdodD0iNzAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+IPCfjoY8L3RleHQ+ICAgPHRleHQgeD0iOTAiIHk9IjExMCIgY2xhc3M9ImJhc2UtbWlkZGxlIiBmaWxsPSIjRkZGRkYiIGZvbnQtZmFtaWx5PSItYXBwbGUtc3lzdGVtLEJsaW5rTWFjU3lzdGVtRm9udCwnU2VnVWkgVUkgR290aGljJyxSb2JvdG8sc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNHB4IiBmb250LXdlaWdodD0iNjAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+RHVpemVuZGVuPC90ZXh0Pjwvc3ZnPg==">
    
    <!-- Additional icons for various devices -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gIDxyZWN0IHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgcng9IjQiIGZpbGw9IiM2NjdlZWEiLz4gIDx0ZXh0IHg9IjE2IiB5PSIyMCIgY2xhc3M9ImJhc2UtbWlkZGxlIiBmaWxsPSIjRkZGRkYiIGZvbnQtZmFtaWx5PSItYXBwbGUtc3lzdGVtLEJsaW5rTWFjU3lzdGVtRm9udCwnU2VnVWkgVUkgR290aGljJyxSb2JvdG8sc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNHB4IiBmb250LXdlaWdodD0iNzAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+8J+OhzwvdGV4dD48L3N2Zz4=">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 0;
            font-size: 16px;
            line-height: 1.5;
            color: #e0e6ed;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0;
            background: #0f1419;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            position: relative;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Enhanced PWA Install Button */
        .install-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: none;
            z-index: 101;
        }

        .install-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        .install-btn.show {
            display: block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Header action buttons */
        .header-actions {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 8px;
            z-index: 101;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            min-height: 40px;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        .controls {
            padding: 20px;
            background: #1a1f2e;
            border-bottom: 1px solid #2d3748;
        }

        .player-input {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .player-input input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #4a5568;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: #2d3748;
            color: #e0e6ed;
            min-height: 48px;
        }

        .player-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
            background: #374151;
        }

        /* Touch Target Optimization - Minimum 48px per accessibility guidelines */
        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-height: 48px;
            min-width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }

        /* Enhanced visual feedback for touch interactions */
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s;
        }

        .btn:active::after {
            width: 100%;
            height: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ff5722);
            color: white;
            width: 100%;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #00d2ff, #3a7bd5);
            color: white;
            width: 100%;
            margin-top: 20px;
            font-size: 18px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0, 210, 255, 0.3);
        }

        .btn-success:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(0, 210, 255, 0.3);
        }

        .game-area {
            flex: 1;
            padding: 20px;
            overflow-x: auto;
            background: #0f1419;
        }

        .players-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 24px;
        }

        .player-card {
            background: #1a1f2e;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border-left: 4px solid #4ecdc4;
            position: relative;
            border: 1px solid #2d3748;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.5);
        }

        .player-card.winner {
            border-left-color: #00b894;
            background: linear-gradient(45deg, #1a2f1a, #0d4f2b);
            animation: winner-pulse 2s infinite;
        }

        .player-card.close-to-win {
            border-left-color: #fdcb6e;
            background: linear-gradient(45deg, #2a2616, #3d3626);
        }

        .player-card.over-limit {
            border-left-color: #e17055;
            background: linear-gradient(45deg, #2a1616, #3d2626);
        }

        @keyframes winner-pulse {
            0%, 100% { transform: scale(1) translateY(-2px); }
            50% { transform: scale(1.02) translateY(-4px); }
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #e0e6ed;
        }

        .player-total {
            font-size: 1.5rem;
            font-weight: 800;
            color: #e0e6ed;
        }

        .remove-player {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .remove-player:active {
            transform: translateY(1px);
            background: #e55656;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .score-input-container {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #2d3748;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #4a5568;
        }

        .round-label {
            font-weight: 600;
            color: #a0aec0;
            min-width: 48px;
            font-size: 14px;
            text-align: center;
        }

        .score-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .score-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 12px;
            width: 48px;
            height: 48px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .score-btn:active {
            transform: translateY(1px);
            background: #5a6fd8;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .score-btn.minus {
            background: #ff6b6b;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .score-btn.minus:active {
            background: #e55656;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .score-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #4a5568;
            border-radius: 12px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            max-width: 100px;
            background: #1a1f2e;
            color: #e0e6ed;
            min-height: 48px;
            transition: all 0.2s ease;
        }

        .score-input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 4px rgba(78, 205, 196, 0.2);
            background: #374151;
        }

        .quick-scores {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
            justify-content: center;
        }

        .quick-score-btn {
            background: #74b9ff;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
            min-height: 44px;
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(116, 185, 255, 0.3);
        }

        .quick-score-btn:active {
            transform: translateY(1px);
            background: #5a9df7;
            box-shadow: 0 1px 4px rgba(116, 185, 255, 0.3);
        }

        .no-players {
            text-align: center;
            padding: 80px 24px;
            color: #a0aec0;
            font-size: 18px;
            line-height: 1.6;
        }

        .rounds-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 8px;
        }

        .rounds-title {
            font-size: 20px;
            font-weight: 700;
            color: #e0e6ed;
        }

        .round-counter {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Status indicators */
        .status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-winner {
            background: #00b894;
            color: white;
        }

        .status-close {
            background: #fdcb6e;
            color: #2d3436;
        }

        .status-over {
            background: #e17055;
            color: white;
        }

        /* Accordion Styles - Optimized for touch */
        .round-accordion {
            margin-bottom: 12px;
        }

        .round-header-btn {
            width: 100%;
            background: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 12px;
            padding: 16px 20px;
            color: #e0e6ed;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            touch-action: manipulation;
            min-height: 56px;
        }

        .round-header-btn:hover {
            background: #4a5568;
            border-color: #667eea;
        }

        .round-header-btn:active {
            transform: translateY(1px);
            background: #4a5568;
        }

        .round-header-btn.expanded {
            background: #4a5568;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom: none;
            border-color: #667eea;
        }

        .round-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .round-number {
            font-weight: 700;
            color: #4ecdc4;
            font-size: 16px;
            min-width: 40px;
        }

        .round-score-display {
            font-weight: 700;
            color: #e0e6ed;
            font-size: 16px;
            padding: 4px 12px;
            border-radius: 8px;
            min-width: 60px;
            text-align: center;
        }

        .round-score-display.positive {
            color: #00b894;
            background: rgba(0, 184, 148, 0.1);
        }

        .round-score-display.negative {
            color: #e17055;
            background: rgba(225, 112, 85, 0.1);
        }

        .round-score-display.zero {
            color: #a0aec0;
            background: rgba(160, 174, 192, 0.1);
        }

        .accordion-icon {
            font-size: 18px;
            transition: transform 0.2s ease;
            color: #a0aec0;
            min-width: 24px;
            text-align: center;
        }

        .accordion-icon.expanded {
            transform: rotate(180deg);
            color: #667eea;
        }

        .round-content {
            background: #2d3748;
            border: 2px solid #4a5568;
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 20px;
            display: none;
        }

        .round-content.expanded {
            display: block;
        }

        .current-round {
            border-left: 4px solid #4ecdc4;
        }

        .current-round .round-header-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border-color: #4ecdc4;
        }

        .current-round .round-number {
            color: white;
        }

        .current-round .round-score-display {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .current-round .accordion-icon {
            color: white;
        }

        .current-round .accordion-icon.expanded {
            color: white;
        }

        /* Enhanced notifications */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #00b894;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 184, 148, 0.4);
            max-width: 300px;
            word-wrap: break-word;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background: #ff6b6b;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.4);
        }

        .notification.warning {
            background: #fdcb6e;
            color: #2d3436;
            box-shadow: 0 4px 20px rgba(253, 203, 110, 0.4);
        }

        /* Table View Styles */
        .table-view {
            overflow-x: auto;
            margin: 20px 0;
        }

        .scores-table {
            width: 100%;
            border-collapse: collapse;
            background: #1a1f2e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            min-width: 300px;
        }

        .scores-table th {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 15px 8px;
            font-weight: 600;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .scores-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #2d3748;
            font-size: 0.9rem;
            color: #e0e6ed;
            position: relative;
        }

        .scores-table tr:hover {
            background-color: rgba(78, 205, 196, 0.1);
        }

        .round-cell {
            background: #2d3748;
            font-weight: 600;
            color: #a0aec0;
            min-width: 60px;
        }

        .score-cell {
            font-weight: 500;
            min-width: 80px;
        }

        .total-row {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 700;
            font-size: 1rem;
        }

        .total-row td {
            border-bottom: none;
            padding: 15px 8px;
        }

        .running-total {
            font-size: 0.75rem;
            color: #a0aec0;
            display: block;
            margin-top: 2px;
            font-weight: 400;
        }

        .score-with-total {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .round-score {
            font-weight: 600;
            color: #e0e6ed;
        }

        /* Leader indicators */
        .leader-1 {
            background: linear-gradient(45deg, #00b894, #55efc4) !important;
            color: #2d3436 !important;
            position: relative;
        }

        .leader-1::after {
            content: "🥇";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
        }

        .leader-2 {
            background: linear-gradient(45deg, #fdcb6e, #e17055) !important;
            color: #2d3436 !important;
            position: relative;
        }

        .leader-2::after {
            content: "🥈";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
        }

        .leader-3 {
            background: linear-gradient(45deg, #fd79a8, #e84393) !important;
            color: white !important;
            position: relative;
        }

        .leader-3::after {
            content: "🥉";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
        }

        .winner-total {
            background: linear-gradient(45deg, #00b894, #55efc4) !important;
            color: #2d3436 !important;
            animation: winner-pulse 2s infinite;
            font-size: 1.2rem !important;
        }

        .close-total {
            background: linear-gradient(45deg, #fdcb6e, #e17055) !important;
            color: #2d3436 !important;
        }

        .over-total {
            background: linear-gradient(45deg, #d63031, #74b9ff) !important;
            color: white !important;
        }

        /* Enhanced offline indicator */
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ff6b6b;
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
            z-index: 9999;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
        }

        .offline-indicator.show {
            transform: translateY(0);
        }

        /* Winner celebration */
        .winner-celebration {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .winner-modal {
            background: linear-gradient(45deg, #00b894, #55efc4);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            color: #2d3436;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: winner-bounce 0.6s ease;
            max-width: 90%;
            margin: 20px;
        }

        .winner-modal h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .winner-modal p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .winner-modal .btn {
            margin-top: 20px;
            background: #2d3436;
            color: white;
        }

        @keyframes winner-bounce {
            0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        /* Share modal */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .share-modal-content {
            background: #1a1f2e;
            border-radius: 20px;
            padding: 30px;
            color: #e0e6ed;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            margin: 20px;
            border: 1px solid #2d3748;
        }

        .share-modal h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4ecdc4;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .share-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 48px;
        }

        .share-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .share-text {
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 12px;
            padding: 16px;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 16px 0;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Performance indicator */
        .performance-indicator {
            position: fixed;
            top: 50px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #4ecdc4;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-family: monospace;
            z-index: 999;
            display: none;
        }

        /* Responsive and Accessibility Improvements */
        @media (max-width: 480px) {
            .player-input {
                flex-direction: column;
                gap: 16px;
            }
            
            .btn-primary {
                width: 100%;
                margin-top: 0;
            }
            
            .score-controls {
                flex-direction: row;
                gap: 12px;
                justify-content: center;
            }
            
            .score-input {
                max-width: 120px;
            }
            
            .quick-scores {
                justify-content: center;
                gap: 8px;
            }

            .quick-score-btn {
                min-width: 80px;
                padding: 14px 18px;
            }

            /* Larger touch targets for smaller screens */
            .score-btn {
                width: 52px;
                height: 52px;
                font-size: 22px;
            }

            .remove-player {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }

            .header-actions {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 10px;
                justify-content: center;
            }

            .install-btn {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 10px;
            }
        }

        /* Large screen optimizations */
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                margin: 0 auto;
                border-radius: 20px;
                overflow: hidden;
                margin-top: 20px;
                margin-bottom: 20px;
                min-height: calc(100vh - 40px);
            }

            .players-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 24px;
            }

            .game-area {
                padding: 32px;
            }

            .controls {
                padding: 24px 32px;
            }
        }

        /* Improved focus states for accessibility */
        .btn:focus-visible,
        .score-btn:focus-visible,
        .quick-score-btn:focus-visible,
        .remove-player:focus-visible,
        .round-header-btn:focus-visible,
        .header-btn:focus-visible,
        .share-btn:focus-visible {
            outline: 3px solid #667eea;
            outline-offset: 2px;
        }

        .player-input input:focus-visible,
        .score-input:focus-visible {
            outline: 3px solid #4ecdc4;
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .player-card {
                border: 2px solid #ffffff;
            }
            
            .score-input-container {
                border: 2px solid #ffffff;
            }
            
            .btn, .score-btn, .quick-score-btn, .header-btn, .share-btn {
                border: 2px solid #ffffff;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .btn, .score-btn, .quick-score-btn, .remove-player, 
            .round-header-btn, .accordion-icon, .header-btn,
            .share-btn, .player-card {
                transition: none;
            }
            
            .winner, .winner-pulse {
                animation: none;
            }

            .install-btn.show {
                animation: none;
            }
        }

        /* Loading states */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            100% { left: 100%; }
        }
    </style>
</head>
<body>
    <div id="offlineIndicator" class="offline-indicator">
        ✈️ Offline modus - alle functies beschikbaar! Scores worden lokaal opgeslagen.
    </div>

    <div id="performanceIndicator" class="performance-indicator"></div>

    <div class="container">
        <div class="header">
            <div class="header-actions">
                <button class="header-btn" onclick="shareGame()" title="Deel scores">📤</button>
                <button class="header-btn" onclick="toggleWakeLock()" title="Scherm aan houden" id="wakeLockBtn">🔆</button>
            </div>
            <button id="installBtn" class="install-btn">
                📲 Installeer App
            </button>
            <h1>🎯 Duizenden</h1>
            <p>Eerste speler die 1000+ punten behaalt wint! • Werkt volledig offline</p>
        </div>

        <div class="controls">
            <div class="player-input">
                <input type="text" id="playerName" placeholder="Speler naam..." maxlength="20" autocomplete="off">
                <button class="btn btn-primary" onclick="addPlayer()">Toevoegen</button>
            </div>
            <button class="btn btn-danger" onclick="resetGame()">Nieuw Spel</button>
            <button class="btn btn-primary" id="viewToggle" onclick="toggleView()" style="margin-top: 10px; width: 100%;">📊 Tabel Weergave</button>
        </div>

        <div class="game-area">
            <div id="gameContent">
                <div class="no-players">
                    👆 Voeg spelers toe om te beginnen!
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="share-modal" style="display: none;" onclick="closeShareModal()">
        <div class="share-modal-content" onclick="event.stopPropagation()">
            <h3>📤 Deel Scores</h3>
            <div class="share-text" id="shareText"></div>
            <div class="share-buttons">
                <button class="share-btn" onclick="copyShareText()">📋 Kopiëren</button>
                <button class="share-btn" onclick="shareViaWebAPI()">📱 Delen</button>
                <button class="share-btn" onclick="shareViaWhatsApp()">💬 WhatsApp</button>
                <button class="share-btn" onclick="shareViaEmail()">📧 Email</button>
            </div>
            <button class="btn" onclick="closeShareModal()" style="width: 100%; margin-top: 20px;">Sluiten</button>
        </div>
    </div>

    <script>
        // Global variables
        let players = [];
        let rounds = [];
        let currentView = 'cards';
        let deferredPrompt;
        let wakeLock = null;
        let isOnline = navigator.onLine;
        let performanceObserver;

        // Enhanced PWA features
        class DuizendenPWA {
            constructor() {
                this.initServiceWorker();
                this.initInstallPrompt();
                this.initOfflineHandling();
                this.initPerformanceMonitoring();
                this.initAppShortcuts();
                this.handleUrlParams();
            }

            async initServiceWorker() {
                if ('serviceWorker' in navigator) {
                    try {
                        const registration = await navigator.serviceWorker.register(this.generateOfflineServiceWorker());
                        console.log('Offline-first SW registered successfully');
                        
                        // Handle service worker updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showNotification('App update beschikbaar - herstart de app!', 'warning');
                                }
                            });
                        });
                    } catch (error) {
                        console.log('SW registration failed:', error);
                        // App still works without service worker
                        showNotification('App werkt volledig offline!', 'success');
                    }
                }
            }

            generateOfflineServiceWorker() {
                const swCode = `
                    const CACHE_NAME = 'duizenden-offline-v3.0';
                    const STATIC_CACHE = 'duizenden-static-v3.0';
                    
                    // Complete offline-first strategy
                    const OFFLINE_FALLBACK = 'data:text/html;charset=utf-8,<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Duizenden - Offline</title><style>body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#1a1a2e,#16213e);color:#e0e6ed;padding:40px;text-align:center;min-height:100vh;display:flex;flex-direction:column;justify-content:center;}h1{color:#4ecdc4;margin-bottom:20px;}p{margin:10px 0;}</style></head><body><h1>🎯 Duizenden</h1><h2>Volledig Offline Beschikbaar!</h2><p>Deze app werkt 100% zonder internetverbinding.</p><p>Je kunt nu:</p><ul style="text-align:left;max-width:300px;margin:20px auto;"><li>Spelers toevoegen</li><li>Scores bijhouden</li><li>Spelresultaten delen</li><li>App installeren</li></ul><p><a href="." style="color:#4ecdc4;text-decoration:none;background:#667eea;padding:12px 24px;border-radius:8px;display:inline-block;margin-top:20px;">🎮 Start Duizenden</a></p></body></html>';

                    // Install event - cache everything we need for offline use
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(STATIC_CACHE)
                                .then(cache => {
                                    // Cache the main app and offline fallback
                                    return cache.addAll([
                                        './',
                                        './?source=pwa',
                                        OFFLINE_FALLBACK
                                    ]);
                                })
                        );
                        self.skipWaiting();
                    });

                    // Activate event - clean up old caches
                    self.addEventListener('activate', event => {
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.map(cacheName => {
                                        if (cacheName !== STATIC_CACHE && cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                        self.clients.claim();
                    });

                    // Fetch event - offline-first strategy
                    self.addEventListener('fetch', event => {
                        // Only handle GET requests
                        if (event.request.method !== 'GET') return;
                        
                        // Skip cross-origin requests
                        if (!event.request.url.startsWith(self.location.origin)) return;

                        event.respondWith(
                            // Try cache first
                            caches.match(event.request)
                                .then(cachedResponse => {
                                    if (cachedResponse) {
                                        return cachedResponse;
                                    }
                                    
                                    // If not in cache and online, try to fetch
                                    return fetch(event.request)
                                        .then(response => {
                                            // Check if valid response
                                            if (!response || response.status !== 200 || response.type !== 'basic') {
                                                return response;
                                            }
                                            
                                            // Clone and cache the response
                                            const responseToCache = response.clone();
                                            caches.open(CACHE_NAME)
                                                .then(cache => {
                                                    cache.put(event.request, responseToCache);
                                                });
                                            
                                            return response;
                                        })
                                        .catch(() => {
                                            // Network failed, return offline fallback for HTML requests
                                            if (event.request.headers.get('accept').includes('text/html')) {
                                                return caches.match(OFFLINE_FALLBACK);
                                            }
                                            // For other requests, return a generic offline response
                                            return new Response('Offline', { status: 503, statusText: 'Service Unavailable' });
                                        });
                                })
                        );
                    });

                    // Background sync for when connection returns
                    self.addEventListener('sync', event => {
                        if (event.tag === 'duizenden-sync') {
                            event.waitUntil(
                                // Sync any pending game data
                                self.clients.matchAll().then(clients => {
                                    clients.forEach(client => {
                                        client.postMessage({ type: 'SYNC_DATA' });
                                    });
                                })
                            );
                        }
                    });

                    // Handle messages from main thread
                    self.addEventListener('message', event => {
                        if (event.data && event.data.command === 'SKIP_WAITING') {
                            self.skipWaiting();
                        }
                    });
                `;

                const blob = new Blob([swCode], { type: 'application/javascript' });
                return URL.createObjectURL(blob);
            }

            initInstallPrompt() {
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    document.getElementById('installBtn').classList.add('show');
                });

                document.getElementById('installBtn').addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        if (outcome === 'accepted') {
                            document.getElementById('installBtn').classList.remove('show');
                            showNotification('App succesvol geïnstalleerd! 🎉');
                        }
                        deferredPrompt = null;
                    }
                });

                // Handle app installed
                window.addEventListener('appinstalled', () => {
                    showNotification('Duizenden app geïnstalleerd! 🎉');
                    document.getElementById('installBtn').classList.remove('show');
                });
            }

            initOfflineHandling() {
                const updateOnlineStatus = () => {
                    const wasOnline = isOnline;
                    isOnline = navigator.onLine;
                    const indicator = document.getElementById('offlineIndicator');
                    
                    if (isOnline && !wasOnline) {
                        indicator.classList.remove('show');
                        this.syncPendingData();
                        showNotification('Verbinding hersteld! 📶');
                    } else if (!isOnline && wasOnline) {
                        indicator.classList.add('show');
                        showNotification('Offline modus - app blijft volledig werken! 🔥');
                    }
                };

                window.addEventListener('online', updateOnlineStatus);
                window.addEventListener('offline', updateOnlineStatus);

                // Check initial state and show offline capability message
                if (!isOnline) {
                    document.getElementById('offlineIndicator').classList.add('show');
                } else {
                    // Show that app can work offline
                    setTimeout(() => {
                        showNotification('💡 App werkt volledig offline - installeer voor beste ervaring!');
                    }, 3000);
                }
            }

            async syncPendingData() {
                // Enhanced background sync
                if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
                    try {
                        const registration = await navigator.serviceWorker.ready;
                        await registration.sync.register('duizenden-sync');
                    } catch (e) {
                        console.log('Background sync not available');
                    }
                }
                
                // Immediate sync
                saveGame();
                console.log('Data synced - app fully functional offline');
            }

            initPerformanceMonitoring() {
                if ('PerformanceObserver' in window) {
                    performanceObserver = new PerformanceObserver((list) => {
                        for (const entry of list.getEntries()) {
                            if (entry.entryType === 'measure') {
                                const indicator = document.getElementById('performanceIndicator');
                                indicator.textContent = `${entry.name}: ${Math.round(entry.duration)}ms`;
                                indicator.style.display = 'block';
                                setTimeout(() => {
                                    indicator.style.display = 'none';
                                }, 2000);
                            }
                        }
                    });
                    performanceObserver.observe({ entryTypes: ['measure'] });
                }
            }

            initAppShortcuts() {
                // Handle app shortcuts from manifest
                const urlParams = new URLSearchParams(window.location.search);
                const action = urlParams.get('action');
                
                if (action === 'new_game') {
                    resetGame();
                    showNotification('Nieuw spel gestart! 🎯');
                } else if (action === 'share') {
                    setTimeout(() => shareGame(), 1000);
                }
            }

            handleUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const gameData = urlParams.get('game');
                
                if (gameData) {
                    try {
                        const decoded = JSON.parse(atob(gameData));
                        if (decoded.players && decoded.rounds) {
                            players = decoded.players;
                            rounds = decoded.rounds;
                            updateDisplay();
                            showNotification('Spel geladen van link! 🔗');
                        }
                    } catch (e) {
                        console.log('Failed to load game from URL:', e);
                    }
                }
            }
        }

        // Enhanced notifications system
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);

            // Vibration feedback if supported
            if ('vibrator' in navigator || 'vibrate' in navigator) {
                navigator.vibrate([50]);
            }
        }

        // Enhanced Wake Lock API
        async function toggleWakeLock() {
            const btn = document.getElementById('wakeLockBtn');
            
            try {
                if (wakeLock === null && 'wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    btn.textContent = '🔅';
                    btn.title = 'Scherm uit laten gaan';
                    showNotification('Scherm blijft aan tijdens het spel');
                    
                    wakeLock.addEventListener('release', () => {
                        btn.textContent = '🔆';
                        btn.title = 'Scherm aan houden';
                        wakeLock = null;
                    });
                } else if (wakeLock !== null) {
                    await wakeLock.release();
                    wakeLock = null;
                    btn.textContent = '🔆';
                    btn.title = 'Scherm aan houden';
                    showNotification('Scherm kan nu uitgaan');
                }
            } catch (err) {
                showNotification('Wake lock niet ondersteund', 'warning');
            }
        }

        // Enhanced offline-first sharing functionality
        function generateShareText() {
            if (players.length === 0) return 'Nog geen spelers toegevoegd';
            
            const ranking = getLeaderRanking();
            let text = `🎯 Duizenden Scorebord (Offline)\n\n`;
            
            ranking.forEach((player, index) => {
                const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '  ';
                text += `${medal} ${player.name}: ${player.total} punten\n`;
            });
            
            text += `\nRonde: ${rounds.length}\n`;
            text += `Datum: ${new Date().toLocaleDateString('nl-NL')}\n`;
            text += `\n🎮 Duizenden - De kaartspel score app\n(Werkt volledig offline!)`;
            
            return text;
        }

        function shareGame() {
            document.getElementById('shareText').textContent = generateShareText();
            document.getElementById('shareModal').style.display = 'flex';
        }

        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
        }

        async function copyShareText() {
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(generateShareText());
                    showNotification('Gekopieerd naar klembord! 📋');
                } else {
                    // Fallback for older browsers or when clipboard API is not available
                    const textArea = document.createElement('textarea');
                    textArea.value = generateShareText();
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        document.execCommand('copy');
                        showNotification('Gekopieerd naar klembord! 📋');
                    } catch (err) {
                        showNotification('Kopiëren mislukt - probeer handmatig selecteren', 'warning');
                    } finally {
                        document.body.removeChild(textArea);
                    }
                }
                closeShareModal();
            } catch (err) {
                showNotification('Kopiëren mislukt', 'error');
            }
        }

        async function shareViaWebAPI() {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Duizenden Scores',
                        text: generateShareText()
                    });
                    closeShareModal();
                    showNotification('Scores gedeeld! 📤');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showNotification('Delen mislukt', 'error');
                    }
                }
            } else {
                // Fallback: copy to clipboard
                await copyShareText();
            }
        }

        function shareViaWhatsApp() {
            const text = encodeURIComponent(generateShareText());
            const whatsappUrl = `whatsapp://send?text=${text}`;
            
            // Try to open WhatsApp app, fallback to web version
            try {
                window.open(whatsappUrl, '_blank');
                closeShareModal();
            } catch (e) {
                // Fallback to web WhatsApp (works offline for installed WhatsApp)
                const webWhatsApp = `https://wa.me/?text=${text}`;
                window.open(webWhatsApp, '_blank');
                closeShareModal();
            }
        }

        function shareViaEmail() {
            const subject = encodeURIComponent('Duizenden Scores');
            const body = encodeURIComponent(generateShareText());
            const emailUrl = `mailto:?subject=${subject}&body=${body}`;
            
            try {
                window.open(emailUrl, '_blank');
                closeShareModal();
            } catch (e) {
                showNotification('Email app niet gevonden', 'warning');
                // Fallback to copying text
                copyShareText();
            }
        }

        // Enhanced game data management
        function saveGame() {
            performance.mark('save-start');
            
            try {
                const gameData = {
                    players: players,
                    rounds: rounds,
                    timestamp: new Date().toISOString(),
                    version: '2.0'
                };
                
                localStorage.setItem('duizenden_game', JSON.stringify(gameData));
                
                // Also save backup
                const backupKey = `duizenden_backup_${Date.now()}`;
                localStorage.setItem(backupKey, JSON.stringify(gameData));
                
                // Clean old backups (keep last 5)
                const allKeys = Object.keys(localStorage).filter(key => key.startsWith('duizenden_backup_'));
                if (allKeys.length > 5) {
                    allKeys.sort().slice(0, -5).forEach(key => localStorage.removeItem(key));
                }
                
                checkForWinner();
                
                performance.mark('save-end');
                performance.measure('save-duration', 'save-start', 'save-end');
                
            } catch (e) {
                showNotification('Opslaan mislukt', 'error');
                console.log('Save error:', e);
            }
        }

        function loadGame() {
            try {
                const saved = localStorage.getItem('duizenden_game');
                if (saved) {
                    const gameData = JSON.parse(saved);
                    players = gameData.players || [];
                    rounds = gameData.rounds || [];
                    updateDisplay();
                    
                    if (players.length > 0) {
                        showNotification('Vorig spel geladen! 🎮');
                    }
                }
            } catch (e) {
                showNotification('Laden mislukt', 'error');
                console.log('Load error:', e);
            }
        }

        // Enhanced winner detection
        function checkForWinner() {
            if (rounds.length === 0) return;

            const playersWithScores = players.map(player => ({
                name: player,
                total: getPlayerTotal(player)
            }));

            const winners = playersWithScores.filter(p => p.total >= 1000);
            
            if (winners.length > 0) {
                let actualWinner;
                if (winners.length === 1) {
                    actualWinner = winners[0];
                } else {
                    actualWinner = winners.reduce((closest, current) => {
                        const closestDistance = Math.abs(1000 - closest.total);
                        const currentDistance = Math.abs(1000 - current.total);
                        return currentDistance < closestDistance ? current : closest;
                    });
                }
                
                setTimeout(() => showWinnerCelebration(actualWinner.name, actualWinner.total), 500);
            }
        }

        function showWinnerCelebration(winnerName, score) {
            const celebrationHtml = `
                <div class="winner-celebration" onclick="closeWinnerModal()">
                    <div class="winner-modal" onclick="event.stopPropagation()">
                        <h2>🎉 WINNAAR! 🎉</h2>
                        <p><strong>${winnerName}</strong></p>
                        <p>heeft gewonnen met ${score} punten!</p>
                        <button class="btn" onclick="shareGame()">📤 Deel Resultaat</button>
                        <button class="btn" onclick="closeWinnerModal()">Doorgaan</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', celebrationHtml);
            
            // Confetti effect
            if ('vibrator' in navigator || 'vibrate' in navigator) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }

        function closeWinnerModal() {
            const modal = document.querySelector('.winner-celebration');
            if (modal) {
                modal.remove();
            }
        }

        // Core game functions (enhanced)
        function addPlayer() {
            const nameInput = document.getElementById('playerName');
            const name = nameInput.value.trim();
            
            if (name === '') {
                showNotification('Voer een speler naam in!', 'warning');
                nameInput.focus();
                return;
            }
            
            if (players.includes(name)) {
                showNotification('Deze speler bestaat al!', 'warning');
                nameInput.focus();
                return;
            }
            
            if (players.length >= 8) {
                showNotification('Maximum 8 spelers toegestaan!', 'warning');
                return;
            }
            
            players.push(name);
            nameInput.value = '';
            
            rounds.forEach(round => {
                if (!round.hasOwnProperty(name)) {
                    round[name] = 0;
                }
            });
            
            updateDisplay();
            saveGame();
            showNotification(`${name} toegevoegd! 👍`);
        }

        function removePlayer(playerName) {
            if (confirm(`Weet je zeker dat je ${playerName} wilt verwijderen?`)) {
                const index = players.indexOf(playerName);
                if (index > -1) {
                    players.splice(index, 1);
                    rounds.forEach(round => {
                        delete round[playerName];
                    });
                    updateDisplay();
                    saveGame();
                    showNotification(`${playerName} verwijderd`);
                }
            }
        }

        function addRound() {
            const newRound = {};
            players.forEach(player => {
                newRound[player] = 0;
            });
            rounds.push(newRound);
            updateDisplay();
            saveGame();
            showNotification(`Ronde ${rounds.length} gestart! 🎯`);
        }

        function updateScore(roundIndex, player, value) {
            if (rounds[roundIndex]) {
                const newValue = parseInt(value) || 0;
                if (newValue < -500 || newValue > 1500) {
                    showNotification('Score moet tussen -500 en 1500 zijn!', 'warning');
                    return;
                }
                rounds[roundIndex][player] = newValue;
                updateDisplay();
                saveGame();
            }
        }

        function adjustScore(roundIndex, player, change) {
            if (rounds[roundIndex]) {
                const currentScore = rounds[roundIndex][player] || 0;
                const newScore = currentScore + change;
                if (newScore < -500 || newScore > 1500) {
                    showNotification('Score limiet bereikt!', 'warning');
                    return;
                }
                rounds[roundIndex][player] = newScore;
                updateDisplay();
                saveGame();
            }
        }

        function addQuickScore(roundIndex, player, score) {
            if (rounds[roundIndex]) {
                const currentScore = rounds[roundIndex][player] || 0;
                const newScore = currentScore + score;
                if (newScore < -500 || newScore > 1500) {
                    showNotification('Score limiet bereikt!', 'warning');
                    return;
                }
                rounds[roundIndex][player] = newScore;
                updateDisplay();
                saveGame();
            }
        }

        function getPlayerTotal(player) {
            return rounds.reduce((total, round) => total + (round[player] || 0), 0);
        }

        function getScoreClass(total) {
            if (total >= 1000) return 'winner';
            if (total >= 950 && total < 1000) return 'close-to-win';
            return '';
        }

        function getStatusText(total) {
            if (total >= 1000) return 'WINNAAR! 🏆';
            if (total >= 950 && total < 1000) return 'Bijna! 🔥';
            return '';
        }

        function toggleView() {
            currentView = currentView === 'cards' ? 'table' : 'cards';
            const toggleBtn = document.getElementById('viewToggle');
            if (currentView === 'table') {
                toggleBtn.textContent = '📱 Kaart Weergave';
            } else {
                toggleBtn.textContent = '📊 Tabel Weergave';
            }
            updateDisplay();
        }

        function getLeaderRanking() {
            const totals = players.map(player => ({
                name: player,
                total: getPlayerTotal(player)
            }));
            
            totals.sort((a, b) => {
                if (a.total >= 1000 && b.total >= 1000) {
                    const aDistance = Math.abs(1000 - a.total);
                    const bDistance = Math.abs(1000 - b.total);
                    return aDistance - bDistance;
                }
                
                if (a.total >= 1000 && b.total < 1000) return -1;
                if (b.total >= 1000 && a.total < 1000) return 1;
                
                return b.total - a.total;
            });
            
            return totals;
        }

        function toggleRound(roundIndex, player) {
            const content = document.getElementById(`round-content-${roundIndex}-${player}`);
            const icon = document.getElementById(`accordion-icon-${roundIndex}-${player}`);
            const headerBtn = document.getElementById(`round-header-${roundIndex}-${player}`);
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
                headerBtn.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                icon.classList.add('expanded');
                headerBtn.classList.add('expanded');
            }
        }

        function getScoreDisplayClass(score) {
            if (score > 0) return 'positive';
            if (score < 0) return 'negative';
            return 'zero';
        }

        function generateTableView() {
            if (players.length === 0) {
                return '<div class="no-players">👆 Voeg spelers toe om te beginnen!</div>';
            }

            if (rounds.length === 0) {
                return '<div class="no-players">🎯 Voeg een ronde toe om scores te zien!</div>';
            }

            const ranking = getLeaderRanking();
            
            let html = '<div class="table-view">';
            html += '<table class="scores-table">';
            
            html += '<tr><th class="round-cell">Ronde</th>';
            players.forEach(player => {
                const rank = ranking.findIndex(r => r.name === player);
                let rankClass = '';
                if (rank === 0) rankClass = 'leader-1';
                else if (rank === 1) rankClass = 'leader-2';
                else if (rank === 2) rankClass = 'leader-3';
                
                html += `<th class="score-cell ${rankClass}">${player}</th>`;
            });
            html += '</tr>';

            rounds.forEach((round, roundIndex) => {
                html += '<tr>';
                html += `<td class="round-cell">R${roundIndex + 1}</td>`;
                
                players.forEach(player => {
                    const roundScore = round[player] || 0;
                    const runningTotal = rounds.slice(0, roundIndex + 1)
                        .reduce((sum, r) => sum + (r[player] || 0), 0);
                    
                    html += `
                        <td class="score-cell">
                            <div class="score-with-total">
                                <span class="round-score">${roundScore > 0 ? '+' : ''}${roundScore}</span>
                                <span class="running-total">(${runningTotal})</span>
                            </div>
                        </td>
                    `;
                });
                html += '</tr>';
            });

            html += '<tr class="total-row">';
            html += '<td>TOTAAL</td>';
            players.forEach(player => {
                const total = getPlayerTotal(player);
                let totalClass = '';
                if (total >= 1000) totalClass = 'winner-total';
                else if (total >= 950 && total < 1000) totalClass = 'close-total';
                
                html += `<td class="${totalClass}">${total}</td>`;
            });
            html += '</tr>';

            html += '</table>';
            html += '</div>';
            
            html += '<button class="btn btn-success" onclick="addRound()">🎯 Nieuwe Ronde</button>';
            
            return html;
        }

        function updateDisplay() {
            performance.mark('update-start');
            
            const gameContent = document.getElementById('gameContent');
            
            if (players.length === 0) {
                gameContent.innerHTML = '<div class="no-players">👆 Voeg spelers toe om te beginnen!</div>';
                return;
            }

            if (currentView === 'table') {
                gameContent.innerHTML = generateTableView();
                performance.mark('update-end');
                performance.measure('update-display', 'update-start', 'update-end');
                return;
            }

            if (rounds.length === 0) {
                addRound();
                return;
            }

            let html = '';
            
            if (rounds.length > 0) {
                html += `
                    <div class="rounds-header">
                        <div class="rounds-title">Scorebord</div>
                        <div class="round-counter">Ronde ${rounds.length}</div>
                    </div>
                `;
            }

            html += '<div class="players-grid">';

            players.forEach(player => {
                const total = getPlayerTotal(player);
                const scoreClass = getScoreClass(total);
                const statusText = getStatusText(total);
                
                html += `
                    <div class="player-card ${scoreClass}">
                        ${statusText ? `<div class="status-indicator status-${scoreClass.split('-')[0] || 'normal'}">${statusText}</div>` : ''}
                        <div class="player-header">
                            <div class="player-name">${player}</div>
                            <div class="player-total">${total}</div>
                            <button class="remove-player" onclick="removePlayer('${player}')" title="Verwijder speler">×</button>
                        </div>
                `;

                rounds.forEach((round, roundIndex) => {
                    const roundScore = round[player] || 0;
                    const isCurrentRound = roundIndex === rounds.length - 1;
                    const scoreClass = getScoreDisplayClass(roundScore);
                    
                    html += `
                        <div class="round-accordion ${isCurrentRound ? 'current-round' : ''}">
                            <button class="round-header-btn ${isCurrentRound ? 'expanded' : ''}" 
                                    id="round-header-${roundIndex}-${player}"
                                    onclick="toggleRound(${roundIndex}, '${player}')">
                                <div class="round-info">
                                    <span class="round-number">R${roundIndex + 1}</span>
                                    <span class="round-score-display ${scoreClass}">
                                        ${roundScore > 0 ? '+' : ''}${roundScore}
                                    </span>
                                </div>
                                <span class="accordion-icon ${isCurrentRound ? 'expanded' : ''}" 
                                      id="accordion-icon-${roundIndex}-${player}">▼</span>
                            </button>
                            <div class="round-content ${isCurrentRound ? 'expanded' : ''}" 
                                 id="round-content-${roundIndex}-${player}">
                                <div class="score-input-container">
                                    <div class="score-controls">
                                        <button class="score-btn minus" onclick="adjustScore(${roundIndex}, '${player}', -5)">−</button>
                                        <input type="number" 
                                               class="score-input" 
                                               value="${roundScore}"
                                               onchange="updateScore(${roundIndex}, '${player}', this.value)"
                                               min="-500" max="1500"
                                               inputmode="numeric">
                                        <button class="score-btn" onclick="adjustScore(${roundIndex}, '${player}', 5)">+</button>
                                    </div>
                                </div>
                                <div class="quick-scores">
                                    <button class="quick-score-btn" onclick="addQuickScore(${roundIndex}, '${player}', -50)">-50</button>
                                    <button class="quick-score-btn" onclick="addQuickScore(${roundIndex}, '${player}', -20)">-20</button>
                                    <button class="quick-score-btn" onclick="addQuickScore(${roundIndex}, '${player}', 20)">+20</button>
                                    <button class="quick-score-btn" onclick="addQuickScore(${roundIndex}, '${player}', 50)">+50</button>
                                    <button class="quick-score-btn" onclick="addQuickScore(${roundIndex}, '${player}', 100)">+100</button>
                                    <button class="quick-score-btn" onclick="addQuickScore(${roundIndex}, '${player}', 150)">+150</button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
            });

            html += '</div>';
            html += '<button class="btn btn-success" onclick="addRound()">🎯 Nieuwe Ronde</button>';

            gameContent.innerHTML = html;
            
            performance.mark('update-end');
            performance.measure('update-display', 'update-start', 'update-end');
        }

        function resetGame() {
            if (confirm('Weet je zeker dat je een nieuw spel wilt starten? Alle scores gaan verloren.')) {
                players = [];
                rounds = [];
                updateDisplay();
                saveGame();
                showNotification('Nieuw spel gestart! 🎯');
            }
        }

        // Enhanced input handling
        function setupInputHandlers() {
            const playerNameInput = document.getElementById('playerName');
            
            playerNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addPlayer();
                }
            });

            // Auto-focus on player input when appropriate
            playerNameInput.addEventListener('blur', function() {
                setTimeout(() => {
                    if (players.length === 0 && document.activeElement !== playerNameInput) {
                        playerNameInput.focus();
                    }
                }, 100);
            });

            // Handle paste events for bulk player addition
            playerNameInput.addEventListener('paste', function(e) {
                setTimeout(() => {
                    const pastedText = e.target.value;
                    const names = pastedText.split(/[,\n\r\t]+/).map(name => name.trim()).filter(name => name);
                    
                    if (names.length > 1) {
                        e.target.value = '';
                        names.forEach(name => {
                            if (name && !players.includes(name) && players.length < 8) {
                                players.push(name);
                            }
                        });
                        
                        rounds.forEach(round => {
                            names.forEach(name => {
                                if (!round.hasOwnProperty(name)) {
                                    round[name] = 0;
                                }
                            });
                        });
                        
                        updateDisplay();
                        saveGame();
                        showNotification(`${names.length} spelers toegevoegd! 👥`);
                    }
                }, 0);
            });
        }

        // Enhanced keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + N for new game
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    resetGame();
                }
                
                // Ctrl/Cmd + S for manual save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveGame();
                    showNotification('Handmatig opgeslagen! 💾');
                }
                
                // Ctrl/Cmd + Enter for new round
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    if (players.length > 0) {
                        addRound();
                    }
                }
                
                // V for toggle view
                if (e.key === 'v' && !e.ctrlKey && !e.metaKey && document.activeElement.tagName !== 'INPUT') {
                    e.preventDefault();
                    toggleView();
                }
                
                // S for share
                if (e.key === 's' && !e.ctrlKey && !e.metaKey && document.activeElement.tagName !== 'INPUT') {
                    e.preventDefault();
                    shareGame();
                }
                
                // Escape to close modals
                if (e.key === 'Escape') {
                    closeShareModal();
                    closeWinnerModal();
                }
            });
        }

        // Enhanced auto-save with debouncing
        let saveTimeout;
        function debouncedSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveGame();
            }, 500);
        }

        // Game statistics
        function getGameStatistics() {
            if (players.length === 0 || rounds.length === 0) return null;
            
            const stats = {
                totalRounds: rounds.length,
                totalPlayers: players.length,
                averageScore: 0,
                highestScore: -Infinity,
                lowestScore: Infinity,
                gameStarted: null,
                gameEnded: null,
                winner: null
            };
            
            let totalScore = 0;
            let scoreCount = 0;
            
            players.forEach(player => {
                const playerTotal = getPlayerTotal(player);
                totalScore += playerTotal;
                scoreCount++;
                
                if (playerTotal > stats.highestScore) {
                    stats.highestScore = playerTotal;
                }
                if (playerTotal < stats.lowestScore) {
                    stats.lowestScore = playerTotal;
                }
                
                if (playerTotal >= 1000 && !stats.winner) {
                    stats.winner = player;
                }
            });
            
            stats.averageScore = Math.round(totalScore / scoreCount);
            
            // Try to get timestamps from localStorage
            try {
                const gameData = JSON.parse(localStorage.getItem('duizenden_game'));
                if (gameData && gameData.timestamp) {
                    stats.gameStarted = new Date(gameData.timestamp);
                }
            } catch (e) {}
            
            return stats;
        }

        // Advanced error handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            showNotification('Er is een fout opgetreden', 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            showNotification('Er is een fout opgetreden', 'error');
        });

        // Initialize enhanced PWA
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize PWA features
            new DuizendenPWA();
            
            // Setup enhanced input handling
            setupInputHandlers();
            
            // Setup keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Load game data
            loadGame();
            
            // Initialize display
            if (players.length === 0) {
                updateDisplay();
                // Auto-focus on player input for better UX
                setTimeout(() => {
                    document.getElementById('playerName').focus();
                }, 100);
            }
            
            // Auto-save on visibility change (user switching tabs/apps)
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    saveGame();
                }
            });
            
            // Auto-save on page unload
            window.addEventListener('beforeunload', function() {
                saveGame();
            });
            
            // Check for updates periodically (only when online)
            setInterval(() => {
                if (navigator.onLine && 'serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ command: 'checkForUpdates' });
                }
            }, 60000); // Check every minute
            
            console.log('🎯 Duizenden PWA loaded successfully!');
            console.log('✅ Fully offline capable - no internet required!');
            
            // Show offline capability message on first load
            if (!localStorage.getItem('duizenden_offline_message_shown')) {
                setTimeout(() => {
                    showNotification('🔥 Deze app werkt 100% offline! Geen internet nodig.', 'success');
                    localStorage.setItem('duizenden_offline_message_shown', 'true');
                }, 2000);
            }
        });

        // Export for debugging (development only)
        if (false) {
            window.duizendenDebug = {
                players,
                rounds,
                getGameStatistics,
                loadGame,
                saveGame,
                resetGame: () => {
                    players = [];
                    rounds = [];
                    updateDisplay();
                    saveGame();
                }
            };
        }
    </script>
</body>
</html>
